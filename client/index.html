<!DOCTYPE html>
<html>
<head>
  <title>image_upload</title>
  <script src="/vue.js"></script>
</head>
<body>
  <div id="app">
    <h1>图片上传</h1>
    <div v-if="!image">
      <h2>Select an image</h2>
      <input type="file" @change="onFileChange">
    </div>
    <div v-else>
      <img :src="image" />
      <button @click="removeImage">Remove image</button>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        image: ''
      },
      methods: {
        onFileChange(e) {
          let files = e.target.files;
          let vm    = this;

          if (!files.length) {
            return;
          }

          if (files[0].type.split("/")[0] !== "image") {
            return;
          }   

          vm.readImgFile(files[0]).then(function (result) {
            vm.image = result;
          });
        },
        readImgFile(file) {
          return new Promise(function (resolve) {
            let reader = new FileReader();

            reader.onload = function () {
              resolve(reader.result);
            };

            reader.readAsDataURL(file);
          });
        },
        removeImage: function (e) {
          this.image = '';
        }
      }
    })
  </script>
</body>
</html>
